<!DOCTYPE html>
<html>
<head>
<script src="Tone.js"></script>
<script>
    //global vars in js?
    var red, green, blue, polySynth;

function startTime() {
    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    document.getElementById('txt').innerHTML =
    h + ":" + m + ":" + s;
    var t = setTimeout(startTime, 500);
    
	var size    = 86400;
	var k = (h * 60 * 60  + m * 60 + s);
	var red   = sin_to_hex(k, 0 * Math.PI * 2/3); // 0   deg
	var blue  = sin_to_hex(k, 1 * Math.PI * 2/3); // 120 deg
	var green = sin_to_hex(k, 2 * Math.PI * 2/3); // 240 deg
//http://www.nikolay.rocks/2015-10-29-rainbows-generator-in-javascript
       document.getElementById('txt').innerHTML =
    h + ":" + m + ":" + s + "          " + k + "  red: " + red + "  green: " + green + " Blue: " + blue;

       //make synth

  var distortion = new Tone.Distortion(0.6)
  var tremolo = new Tone.Tremolo().start()
  var chords = [`${red}`, `${green}`, `${blue}`];


Tone.Transport.
      //rainbow[i] = "#"+ red + green + blue;
      if ( s > 10) { //this is the result of some sort of very wacky bug that does not make sense right now
          document.body.style.backgroundColor = "#"+ red + green + blue; //`rgb(${red}, ${green}, ${blue})`;
        polySynth = new Tone.PolySynth(4, Tone.Synth).chain(distortion, tremolo, Tone.Master)
        polySynth.triggerAttack(chords);
        if (s  == 59) {
          //playTone(red, green, blue);
        }
      }

    function sin_to_hex(l, phase) {
      var sin = Math.sin(Math.PI / size * 2 * l + phase);
      var int = Math.floor(sin * 127) + 128;
      var hex = int.toString(16);

      return hex.length === 1 ? "0"+hex : hex;
    }
    
    
}

function playTone(red, green, blue) {
  var distortion = new Tone.Distortion(0.6)
  var tremolo = new Tone.Tremolo().start()
  var chords = [`${red}`, `${green}`, `${blue}`];

  var polySynth = new Tone.PolySynth(4, Tone.Synth).chain(distortion, tremolo, Tone.Master)

  polySynth.triggerAttack(chords)
}

function checkTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}
</script>
</head>

<body onload="startTime();">

<div id="txt"></div>

</body>
</html>
</html>

